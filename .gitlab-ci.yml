image: runmymind/docker-android-sdk:ubuntu-standalone

before_script:
  # Ask gradle to put everything to .gradle dir so that we can cache it
  - export GRADLE_USER_HOME=`pwd`/.gradle

cache:
  key: "mealie-android"
  paths:
    - .gradle

stages:
  - lint
  - build
  - test

lintDebug:
  interruptible: true
  stage: lint
  needs: [ ]
  script:
    - ./gradlew lintDebug -PbuildDir=lint
  artifacts:
    when: always
    paths:
      - app/lint

assembleDebug:
  interruptible: true
  stage: build
  needs: [ ]
  script:
    - ./gradlew assembleDebug
  artifacts:
    paths:
      - app/build/outputs/

debugTests:
  interruptible: true
  stage: test
  needs: [ "assembleDebug" ]
  script:
    - ./gradlew testDebug
  artifacts:
    when: always
    reports:
      junit: ./**/build/test-results/**/TEST-*.xml